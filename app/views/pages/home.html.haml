%div.flex_center.flex_column
  %p.red.sans.bold.p1
    %span{:style => 'width:42px;margin-right: 5px;'}
      =image_tag( 'icon-color-noBGsvg.svg', :alt => 'splash', :style => 'height:42px;', :class => 'splash')
    Welcome to Pinball Map!
  %p.welcome.font20.center.mt_0{:style => 'max-width:540px;min-width:100px;line-height:32px;'}
    Founded in 2008, Pinball Map is an open source, crowdsourced worldwide map of public pinball machines.
  %p.explore
    = link_to 'Explore the Map', map_path
  %p.welcome.font20.center.mt10.mb_5
    - if mobile_device?
      Better yet! Use the
    - else
      Check out the
    award-winning
    = link_to "mobile app", app_path, :style => "color: #fd0091;"
  %p.italic.flex_center.mlr_10
    =image_tag( 'machine-pink.png', :alt => 'machine', :style => 'height:32px;margin-right:5px;', :class => 'splash')
    The map was last updated&nbsp;
    %span{:style => 'background: #f8f18e'}
      =distance_of_time_in_words(Time.now, @last_updated_time)
      ago&nbsp;
%div.flex_center.bg_purple
  %p.red.font28.sans.bold.mt_20.mb_5 News
%div.flex_center.mobile_flex.flex_top.bg_purple
  .news.serif
    %p
      The Fall 2022 stickers are IN! They might be our shiniest stickers yet. Brushed gold with black ink. Buy them on our
      = link_to 'Pinball Map official sanctioned licensed and bonded store!', store_path, :class => "bold"
    %p
      Pinball Map was voted Best Pinball App in the 2021
      = link_to "TWIPy Awards!", "https://twipys.com/", :target => '_blank'
      = link_to "Thank you for voting for us!", "https://blog.pinballmap.com/2022/03/29/2021-TWIPY-Award/", :target => '_blank', :class => "bold"
    %p
      Check the
      = link_to "blog", "https://blog.pinballmap.com/", :class => "bold"
      to keep up with map news.
      = link_to "Support Pinball Map via Patreon.", "https://patreon.com/pinballmap", :class => "bold", :target => '_blank'
    %p
      Looking for a fun and friendly way to chat with us, as well as with other pinball lovers? Join
      = link_to 'The Pinball People', 'https://discord.gg/XffPx6VKTv', :class => "bold", :target => '_blank'
      Discord!
    %p
      Did you know
      = link_to 'Pinball Map has an open API?', apipie_apipie_path
      = link_to 'Stern Pinball', 'https://sternpinball.com/pinball-locator/', :target => '_blank'
      uses our data for their machine locator. Our API is also used by
      = link_to 'Matchplay Events', 'https://matchplay.events/', :target => '_blank'
      and
      = link_to 'Pindigo', 'https://pindigo.app/', :target => '_blank'
      and
      = link_to 'Scorbit', 'https://scorbit.io/', :target => '_blank'
      and many others! If you use the data, please provide attribution!
  .news.serif
    %p
      Pinball Map is listing
      %span.red.font18.sans.bold
        #{number_with_delimiter(Location.all.count,:delimiter => ",")}
      locations and
      %span.red.font18.sans.bold
        #{number_with_delimiter(LocationMachineXref.all.count,:delimiter => ",")}
      machines.
    %p
      This is a user-powered map. You can help keep it up to date by adding and removing machines, submitting new locations, and telling your friends to use it!
    %p
      The data is managed by over 100 administrators and thousands of active users.
    %p
      We have a free
      = link_to 'mobile app for iOS and Android.', app_path
    %p
      Pinball Map is not monetized - no ads or premium membership. The
      = link_to 'code is open source.', 'https://github.com/pinballmap/pbm'
      Follow us on Twitter for a massive amount of map updates.
      = link_to '@pinballmapcom', 'https://twitter.com/pinballmapcom', :target => '_blank'
    %p
      = link_to 'Contact us!', 'portland/about'
%div.flex_center.flex_column.mb_20
  %p.red.font28.sans.bold.mt_20.mb_5
    Recent Blog Posts
  - url = 'https://blog.pinballmap.com/feed.xml'
  - xml = HTTParty.get(url).body
  - if !xml.blank?
    - feed = Feedjira.parse(xml)
    - feed.entries.take(5).each do |entry|
      %div.m_5.center
        =link_to entry.title, 'https://blog.pinballmap.com' + entry.url, :target => '_blank', :class => 'bold font18'
        %span.block.center.m_5 #{entry.published.strftime("%b %d, %Y")}
  - else
    %div.m_5.center None found

%div.flex_center.flex_column.bg_purple.mb_20
  .region_map
    %p.red.font28.sans.bold.mt_20.mb_5.center
      Regional Maps
    %p
      If the
      = link_to 'big map', map_path
      isn&rsquo;t cutting it for you, you can search for machines in one select area. Please pick a "regional" map below. Regions are predefined geographical areas - they can be a city, county, state, or even a country - that an administrator and the local users created. Each regional map is curated by a local administrator, often with the support of a league.
    - if !mobile_device?
      #region_map
    #region_list
      - @all_regions.each.map {|r| r.state}.uniq.each do |s|
        %div.state_name_container
          %div.state_name
            %span.state_name #{s}
          %div.region_name_container
            - @all_regions.select {|r| r.state == s}.each do |r|
              %div.region_name
                =link_to "/#{r.name}" do
                  #{r.full_name}

- unless Rails.env.test?
  :javascript
    $().ready(function(){
        initializeRegionMap(
          [#{@region_data[0].join(', ')}],
          [#{@region_data[1].join(', ')}],
          [#{@region_data[2].join(', ')}],
          [#{@region_data[3].join(', ').html_safe}]
        );
    });

