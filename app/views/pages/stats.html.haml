#page_body
  .column_container.stats_container
    .column.w_560.bg_vlightpurple
      %p.red.bold.p1 Pinball Map Stats
      %p Started mapping in 2008.
      %p
        Currently listing
        %span{:class => 'red font18 bold'}
          #{number_with_delimiter(@locations_count_total,:delimiter => ",")}
        locations and
        %span{:class => 'red font18 bold'}
          #{number_with_delimiter(@machines_count_total,:delimiter => ",")}
        machines.
      %p
        #{number_with_delimiter(@users_count_total,:delimiter => ",")} registered user accounts (since 2017).
      %p
        #{number_with_delimiter(@user_submissions_total,:delimiter => ",")} maps edits (since 2015-ish).
      %p
        #{number_with_delimiter(@user_submissions_week,:delimiter => ",")} map edits in the last week.
    .column{:style => "width: 100%;"}
      %div
        %p.bold.center Pinball machines made this year, added to locations
        =line_chart @machine_adds_this_year.group('machine.name').group_by_month(:created_at).count, height: "600px"
      %div.mt_20
        %p.bold.center Pinball machines made last year, added to locations
        =line_chart @machine_adds_last_year.group('machine.name').group_by_month(:created_at).count, height: "600px"
      %div.mt_20.mb_20
        %p.bold.center Annual map edits from 2019 to today
        =line_chart @user_submissions_all.group_by_year(:created_at).count, xmin: "2019-01-01", thousands: ","
    .column.w560.bg_vlightpurple
      %p.font20.center.bold.pbt_5.bg_lightpurple
        Top 25 machines
      - @top_25.each do |row|
        %div{:style => 'display: flex; flex-direction: row; justify-content: space-between; padding: 0 10px;'}
          %p== #{link_to "#{row['machine_name']} (#{row['manufacturer']}, #{row['year']})", "/map?by_machine_id=#{row['id']}"}
          %p.bold.stat_values #{number_with_delimiter(row['machine_count'],:delimiter => ",")}
      %p.font20.center.bold.pbt_5.bg_lightpurple
        Top 10 cities by number of locations
      - @top_cities.each do |row|
        %div{:style => 'display: flex; flex-direction: row; justify-content: space-between; padding: 0 15px;'}
          %p #{row.city}
          %p.bold.stat_values #{number_with_delimiter(row.location_count,:delimiter => ",")}
      %p.font20.center.bold.pbt_5.bg_lightpurple
        Top 10 cities by number of machines
      - @top_cities_by_machine.each do |row|
        %div{:style => 'display: flex; flex-direction: row; justify-content: space-between; padding: 0 10px;'}
          %p #{row.city}
          %p.bold.stat_values #{number_with_delimiter(row.machines_count,:delimiter => ",")}
      %p.font20.center.bold.pbt_5.bg_lightpurple
        Top 25 users (# of edits)
      - @top_users.each do |row|
        %div{:style => 'display: flex; flex-direction: row; justify-content: space-between; padding: 0 10px; align-items: flex-end;'}
          %p #{row.username}
          %p.bold.stat_values #{number_with_delimiter(row.user_submissions_count,:delimiter => ",")}


